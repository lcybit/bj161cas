<!DOCTYPE html>
<html>

<head>
<title>设置教学计划</title>
<link rel="stylesheet" href="/plugin/layui/css/layui.css" />
<script src="/plugin/layui/layui.all.js"></script>
<script src="/plugin/jquery/jquery.js"></script>
<script src="/plugin/jquery/jquery.serializejson.js"></script>
<script src="/plugin/jsrender/jsrender.js"></script>
</head>

<body>
  <div class="layui-container" style="width:100%;">
    <div class="layui-row" id="schedulePlanView"></div>
    <div class="layui-form-item">
      <div class="layui-input-inline layui-button-group">
        <button class="layui-btn layui-btn-sm" type="button" onclick="goCopy()">复制</button>
        <button class="layui-btn layui-btn-sm" type="button" onclick="cancel()">确定</button>
      </div>
    </div>
  </div>
  <script id="tmpl-schedulePlanView" type="text/x-jsrender">
    <div class="layui-col-md12" id="tclassSchedule" style="overflow-x:hidden; overflow-y:auto;">
      <table class="layui-table" id="{{:key}}" lay-size="sm">      
        <thead>        
          <tr>
            <th></th>
            <th>课时</th>
            {{for tclassList tmpl="#tmpl-tclassListView" /}}      
          </tr>
        </thead>
        <tbody>
	      {{props coursePlanViewMap tmpl="#tmpl-coursePlanView" /}}
        </tbody>
      </table>     
    </div>
  </script>
  <script id="tmpl-tclassListView" type="text/x-jsrender">
    <th id="{{:tclassId}}">{{:name}}</th>  
  </script>
  <script id="tmpl-coursePlanView" type="text/x-jsrender">   
   {{for prop}}
    <tr>    
      <td >{{:course.name}}</td> 
      <td class="layui-td" onclick="clickSelectPidNum('{{:course.courseId}}')">{{:periodNum}}</td> 
      {{props paneMap tmpl="#tmpl-paneMapView" /}}
    </tr>   
   {{/for }} 
  </script>
  <script id="tmpl-paneMapView" type="text/x-jsrender">
   {{for prop}}
     <td class="layui-td" onclick="clickSelectTeacher('{{:planId}}')">{{if teacher!=null}}{{:teacher.name}}{{/if}}</td>         
   {{/for }} 
  </script>

  <script>
    var layer = layui.layer;
    var laypage = layui.laypage;
    var table = layui.table;
    var upload = layui.upload;
    var form = layui.form;
    var gradeId = sessionStorage.getItem('currentGradeId');
    var scheduleId = sessionStorage.getItem('currentScheduleId');
  
    $(document).ready(function() {
      display();
    });
  
    function display() {
      $.ajax({
        async: false,
        url: '/plan/display/' + gradeId + '/' + scheduleId,
        type: 'GET',
        success: function(schedulePlanView) {
          $('#schedulePlanView').html($.templates('#tmpl-schedulePlanView').render(schedulePlanView));
        }
      });
    }
  
    function clickSelectPidNum(courseId) {
      sessionStorage.setItem('currentCourseId', courseId);
      layer.open({
        type: 2,
        id: 'clickSelectPidNum',
        title: '选择课时数',
        content: '/html/schedule/schedule/showPidNum.html',
        area: [ '400px', '250px' ],
        shade: 0.5,
        shadeClose: true,
        closeBtn: false,
      });
    }
  
    function clickSelectTeacher(planId) {
      sessionStorage.setItem('currentPlanId', planId);
      layer.open({
        type: 2,
        id: 'clickSelectTeacher',
        title: '选择教师',
        content: '/html/schedule/schedule/showTeacherList.html',
        area: [ '800px', '400px' ],
        shade: 0.5,
        shadeClose: true,
        closeBtn: false,
      });
    }
    
    function goCopy() {
      sessionStorage.setItem('copyingObject', 'plan');
      layer.open({
        type: 2,
        id: 'copy',
        title: '选择课表',
        content: '/html/schedule/schedule/copy.html',
        area: [ '800px', '400px' ],
        shade: 0.5,
        shadeClose: true,
        closeBtn: false
      });
    }
  
    function cancel() {
      var index = parent.layer.getFrameIndex(window.name);
      parent.layer.close(index);
    }
  </script>
</body>

</html>
