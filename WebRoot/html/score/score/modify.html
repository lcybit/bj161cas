<!DOCTYPE html>
<html xmlns:c="http://www.w3.org/1999/XSL/Transform">

<head>
<title>修改成绩信息</title>
<link rel="stylesheet" href="/plugin/layui/css/layui.css" />
<script src="/plugin/layui/layui.all.js"></script>
<script src="/plugin/jquery/jquery.js"></script>
<script src="/plugin/jquery/jquery.serializejson.js"></script>
<script src="/plugin/jsrender/jsrender.js"></script>
</head>

<body>
  <div class="layui-container" style="margin:30px;">
    <form class="layui-form layui-form-pane" id="exam" method="post">
      <!-- 隐藏考试ID -->
      <input class="layui-input" name="exam_id" id="exam_id" type="hidden" />
      <input class="layui-input" name="student_id" id="student_id" type="hidden" />
      <div class="layui-form-item">
        <label class="layui-form-label">子课程：</label>
        <div class="layui-input-block">
          <select name="sr_course_id" id="srCourse">
            <option value="">请选择子课程</option>

          </select>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">分数：</label>
        <div class="layui-input-block">
          <input class="layui-input" name="score" id="score" type="text" />
        </div>
      </div>
      <div class="layui-form-item">
        <div class="layui-input-inline layui-btn-group">
          <button class="layui-btn layui-btn-sm" type="button" onclick="modify()">保存</button>
          <button class="layui-btn layui-bg-red layui-btn-sm" type="button" onclick="cancel()">取消</button>
        </div>
      </div>
    </form>
  </div>
  <script>
      var courseId = sessionStorage.getItem('currentCourseId');
    $(document).ready(function() {
      var examId = sessionStorage.getItem('currentExamId');
      var student_id = sessionStorage.getItem('currentStudentId');
      $('#exam_id').attr('value', examId);
      $('#student_id').attr('value', student_id);

      layui.use('form', function() {
        layui.form.render();
      });

        querySrCourse()
    });
  
    function modify() {
        if ($('#srCourse').val()==="" || $('#score').val()===""){
            layer.alert("信息请填写完整", {icon:2});
            return;
        }
      $.ajax({
        async: false,
        url: '/score/modify',
        type: 'POST',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify($('#exam').serializeJSON()),
        success: function(result) {
            if (result.code === 200){
                top.layer.msg(result.msg);
                cancel();
            }
            else {
                layer.alert(result.msg, {icon:2});
            }
        }
      });
    }
  
    function cancel() {
      var index = parent.layer.getFrameIndex(window.name);
      parent.layer.close(index);
    }

    //加载子课程
    function querySrCourse() {
        var $ = layui.jquery;
        var form = layui.form;
        $.ajax({
            type:'get',
            url:'/sr_course/listByCourseId/'+courseId,
            dataType:'json',
            success : function (data) {
                var root = document.getElementById("srCourse");
                for (var  i = 0; i < data.length; i++){
                    var option = document.createElement("option");
                    option.setAttribute("value", data[i].id);
                    option.innerText = data[i].sr_course_name;
                    root.appendChild(option);
                    form.render('select');
                }
            }
        });
    }
  </script>
</body>

</html>
